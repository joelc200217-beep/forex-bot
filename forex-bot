forex-bot/
‚îÇ
‚îú‚îÄ‚îÄ bot.py
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ Procfile

import yfinance as yf
import pandas as pd
import numpy as np
import time
import requests
import os

# --- CONFIGURACI√ìN DESDE VARIABLES DE ENTORNO ---
TOKEN = os.getenv("TOKEN")
CHAT_ID = os.getenv("CHAT_ID")

SLEEP_TIME = 1200  # segundos (20 minutos)
PERIOD = "7d"
TIMEFRAME = "30m"

PAIRS = [
    "EURUSD=X",
    "GBPUSD=X",
    "USDJPY=X",
    "USDCAD=X",
    "AUDUSD=X",
    "NZDUSD=X",
    "EURJPY=X",
    "CHFJPY=X",
    "EURGBP=X"
]

# --- FUNCIONES ---

def send_telegram_message(message):
    """Env√≠a mensajes a Telegram"""
    url = f"https://api.telegram.org/bot{TOKEN}/sendMessage"
    params = {"chat_id": CHAT_ID, "text": message, "parse_mode": "HTML"}
    try:
        requests.get(url, params=params)
    except Exception as e:
        print(f"‚ö†Ô∏è Error enviando mensaje: {e}")

def get_data(pair):
    """Descarga datos desde Yahoo Finance"""
    data = yf.download(pair, period=PERIOD, interval=TIMEFRAME)
    if data.empty:
        raise ValueError(f"Sin datos para {pair}")

    close_series = pd.to_numeric(data["Close"].squeeze(), errors="coerce")
    data = pd.DataFrame({"Close": close_series})
    data.dropna(inplace=True)
    return data

def calculate_indicators(data):
    """Calcula RSI y medias m√≥viles"""
    delta = data["Close"].diff()
    gain = delta.clip(lower=0)
    loss = -delta.clip(upper=0)
    avg_gain = gain.rolling(window=14, min_periods=1).mean()
    avg_loss = loss.rolling(window=14, min_periods=1).mean()
    rs = avg_gain / avg_loss.replace(0, np.nan)
    data["RSI"] = 100 - (100 / (1 + rs))

    data["SMA_20"] = data["Close"].rolling(window=20).mean()
    data["SMA_50"] = data["Close"].rolling(window=50).mean()
    return data

def generate_signal(data):
    """Genera se√±ales basadas en RSI y medias m√≥viles"""
    rsi = float(data["RSI"].iloc[-1])
    short_ma = float(data["SMA_20"].iloc[-1])
    long_ma = float(data["SMA_50"].iloc[-1])

    if rsi < 35 and short_ma > long_ma:
        return "üü¢ COMPRA FUERTE"
    elif rsi < 45 and short_ma > long_ma:
        return "üü° COMPRA D√âBIL"
    elif rsi > 65 and short_ma < long_ma:
        return "üî¥ VENTA FUERTE"
    elif rsi > 55 and short_ma < long_ma:
        return "üü† VENTA D√âBIL"
    else:
        return "‚è∏ NEUTRO"

# --- LOOP PRINCIPAL ---
print("üöÄ Iniciando bot de se√±ales Forex multi-divisa (cada 20 min)...")

while True:
    for pair in PAIRS:
        try:
            data = get_data(pair)
            data = calculate_indicators(data)
            signal = generate_signal(data)

            last_price = float(data["Close"].iloc[-1])
            message = (
                f"üí± <b>{pair}</b>\n"
                f"üìä Precio actual: {last_price:.5f}\n"
                f"üìà Se√±al: {signal}"
            )
            print(message)
            send_telegram_message(message)

        except Exception as e:
            print(f"‚ö†Ô∏è Error analizando {pair}: {e}")

    print("‚è≥ Esperando 20 min para el pr√≥ximo an√°lisis...\n")
    time.sleep(SLEEP_TIME)
yfinance
pandas
numpy
requests

worker: python bot.py
